{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 0783f4a5e453e0e1ae78","webpack:///./src/Routine.js"],"names":[],"mappings":"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","file":"Routine.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"routine\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"routine\"] = factory();\n\telse\n\t\troot[\"routine\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 0783f4a5e453e0e1ae78\n **/","export default class Routine {\n\n\taborted = false;\n\n\tactions = [];\n\n\thandlers = {};\n\n\terrorHandler = undefined;\n\n\tcurrentAction = undefined;\n\n\tstatic set (scope) {\n\t\treturn new Routine(scope);\n\t}\n\n\tconstructor (scope) {\n\t\tthis.scope = scope;\n\t}\n\n\taddAction (action) {\n\t\tthis.actions.push((arg)=> {\n\t\t\tif(!this.aborted) {\n\t\t\t\tthis.currentAction = action;\n\t\t\t\treturn action.call(this.scope, arg);\t\n\t\t\t}\n\t\t});\n\t\treturn this;\n\t}\n\n\tfirst (action) {\n\t\tthis.addAction(action);\n\t\treturn this;\n\t}\n\n\tthen (action) {\n\t\tthis.addAction(action);\n\t\treturn this;\n\t}\n\n\tonError (action) {\n\t\tthis.errorHandler = action;\n\t\treturn this;\n\t}\n\n\ton (eventName, action) {\n\t\tthis.handlers[eventName] = action;\n\t\treturn this;\n\t}\n\n\tget and () {\n\t\treturn this;\n\t}\n\n\tget but () {\n\t\treturn this;\n\t}\n\n\trun () {\n\t\tlet lastResult;\n\n\t\ttry {\n\t\t\tfor (let i = 0; i < this.actions.length; i++) {\n\t\t\t\tlet action = this.actions[i];\n\t\t\t\tlastResult = action(lastResult);\n\n\t\t\t\tif (lastResult instanceof Promise) {\n\t\t\t\t\tconst actionsToPromisify = this.actions.slice(i + 1, this.actions.length);\n\t\t\t\t\treturn runAsynchronously(this, actionsToPromisify, lastResult);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn lastResult;\n\t\t}\n\t\tcatch (error) {\n\t\t\tinvokeErrorHandlerOn(this, error);\n\t\t}\n\t}\n}\n\nfunction runAsynchronously (routine, actions, lastResult) {\n\tlet promise = Promise.resolve(lastResult);\n\n\tfor (let action of actions) {\n\t\tpromise = promise.then(action);\n\t}\n\n\tpromise = promise.catch(error => {\n\t\tif (routine.handlers.error) {\n\t\t\troutine.aborted = true;\n\t\t\tsetTimeout(()=> {\n\t\t\t\tinvokeErrorHandlerOn(routine, error);\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.reject(error);\n\t\t}\n\t});\n\n\treturn promise;\n}\n\nfunction invokeErrorHandlerOn (routine, error) {\n\terror.$state = routine.scope.state;\n\terror.$invocation = {\n\t\taction: routine.currentAction.name\n\t};\n\n\tif(routine.handlers.error) {\n\t\troutine.handlers.error(error);\n\t}\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Routine.js\n **/"],"sourceRoot":""}