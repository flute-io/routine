{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap c33b9f44b7fa84c08d8f","webpack:///./src/Routine.js","webpack:///./src/EnsureThat.js"],"names":[],"mappings":"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","file":"Routine.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"routine\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"routine\"] = factory();\n\telse\n\t\troot[\"routine\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap c33b9f44b7fa84c08d8f\n **/","export {ensureThat} from './EnsureThat';\n\nexport default class Routine {\n\n\taborted = false;\n\n\toperations = [];\n\n\thandlers = {};\n\n\terrorHandler = undefined;\n\n\tcurrentOperation = undefined;\n\n\tstatic set (scope) {\n\t\treturn new Routine(scope);\n\t}\n\n\tconstructor (scope) {\n\t\tthis.scope = scope;\n\n\t\tscope.routine = this;\n\t}\n\n\taddOperation (operation) {\n\n\t\tlet func;\n\n\t\tif (isRunnable(operation)) {\n\t\t\tfunc = () => {\n\t\t\t\treturn operation.run(this);\n\t\t\t};\n\t\t}\n\t\telse {\n\t\t\tfunc = (arg) => {\n\t\t\t\tthis.currentOperation = operation;\n\t\t\t\treturn operation.call(this.scope, arg);\n\t\t\t};\n\t\t}\n\n\t\tthis.operations.push((arg)=> {\n\t\t\tif (!this.aborted) {\n\t\t\t\treturn func(arg);\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tfirst (operation) {\n\t\tthis.addOperation(operation);\n\t\treturn this;\n\t}\n\n\tthen (operation) {\n\t\tthis.addOperation(operation);\n\t\treturn this;\n\t}\n\n\tonError (operation) {\n\t\tthis.errorHandler = operation;\n\t\treturn this;\n\t}\n\n\ton (eventName, operation) {\n\t\tthis.handlers[eventName] = operation;\n\t\treturn this;\n\t}\n\n\tget and () {\n\t\treturn this;\n\t}\n\n\tget but () {\n\t\treturn this;\n\t}\n\n\tabort () {\n\t\tthis.aborted = true;\n\t}\n\n\trun () {\n\t\tlet lastResult;\n\n\t\ttry {\n\t\t\tfor (let i = 0; i < this.operations.length; i++) {\n\t\t\t\tlet operation = this.operations[i];\n\t\t\t\tlastResult = operation(lastResult);\n\n\t\t\t\tif (lastResult instanceof Promise) {\n\t\t\t\t\tconst operationsToPromisify = this.operations.slice(i + 1, this.operations.length);\n\t\t\t\t\treturn runAsynchronously(this, operationsToPromisify, lastResult);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn lastResult;\n\t\t}\n\t\tcatch (error) {\n\t\t\tinvokeErrorHandlerOn(this, error);\n\t\t}\n\t}\n}\n\nfunction runAsynchronously (routine, operations, lastResult) {\n\tlet promise = Promise.resolve(lastResult);\n\n\tfor (let operation of operations) {\n\t\tpromise = promise.then(operation);\n\t}\n\n\tpromise = promise.catch(error => {\n\t\tif (routine.handlers.error) {\n\t\t\troutine.abort();\n\t\t\treturn new Promise(resolve => {\n\t\t\t\tinvokeErrorHandlerOn(routine, error);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\treturn Promise.reject(error);\n\t});\n\n\treturn promise;\n}\n\nfunction invokeErrorHandlerOn (routine, error) {\n\terror.$state = routine.scope.state;\n\terror.$invocation = {\n\t\toperation: routine.currentOperation.name\n\t};\n\n\tif (routine.handlers.error) {\n\t\troutine.handlers.error(error);\n\t}\n}\n\nfunction isRunnable (operation) {\n\treturn typeof operation === 'object' && operation.run !== undefined;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Routine.js\n **/","export function ensureThat (operation) {\n\treturn new EnsureThat(operation);\n}\n\nexport default class EnsureThat {\n\n\tscope = {};\n\n\toperations = [];\n\n\telseOperation = undefined;\n\n\tconstructor (operation) {\n\t\tthis.addOperation(operation);\n\t}\n\n\taddOperation (operation) {\n\t\tthis.operations.push(operationPreppedForExecution(operation, this));\n\t}\n\n\tget and () {\n\t\treturn this;\n\t}\n\n\tthat (operation) {\n\t\tthis.addOperation(operation);\n\t\treturn this;\n\t}\n\n\totherwise (operation) {\n\t\tthis.elseOperation = operationPreppedForExecution(operation, this);\n\t\treturn this;\n\t}\n\n\trun (routine) {\n\t\tthis.routine = routine;\n\n\t\tfor (let i = 0; i < this.operations.length; i++) {\n\t\t\tlet operation = this.operations[i];\n\t\t\tlet result = operation();\n\n\t\t\tif (result instanceof Promise) {\n\t\t\t\tconst operationsToPromisify = this.operations.slice(i + 1, this.operations.length);\n\t\t\t\treturn runAsynchronously(this, operationsToPromisify, result);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!result) {\n\t\t\t\t\tif (this.elseOperation) {\n\t\t\t\t\t\tthis.routine.abort();\n\t\t\t\t\t\treturn this.elseOperation();\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthrow conditionalErrorFor(routine);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}\n}\n\nfunction runAsynchronously (runner, _operations, lastResult) {\n\tlet routine = runner.routine;\n\tlet promise = lastResult;\n\tlet operations = [promise].concat(_operations);\n\n\tfor (let operation of operations) {\n\t\tpromise = promise\n\t\t\t.then(operation)\n\t\t\t.then(result => {\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn Promise.reject(conditionalErrorFor(routine));\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\treturn promise;\n}\n\nfunction conditionalErrorFor (routine) {\n\treturn new Error(`Required condition of routine was not met -  ${routine.currentOperation.name} returned false`);\n}\n\nfunction operationPreppedForExecution (operation, runnable) {\n\treturn (args) => {\n\t\trunnable.routine.currentOperation = operation;\n\t\treturn operation.call(runnable.routine.scope, args);\n\t};\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/EnsureThat.js\n **/"],"sourceRoot":""}