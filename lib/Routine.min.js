!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("routine",[],e):"object"==typeof exports?exports.routine=e():t.routine=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e,r){var n=Promise.resolve(r),o=!0,i=!1,a=void 0;try{for(var u,c=function(){var e=u.value;n=n.then(function(r){return t.invoke({operation:e,args:r})})},f=e[Symbol.iterator]();!(o=(u=f.next()).done);o=!0)c()}catch(l){i=!0,a=l}finally{try{!o&&f["return"]&&f["return"]()}finally{if(i)throw a}}return n=n["catch"](function(e){return t.handlers.error?(t.abort(),new Promise(function(r){s.handleError(t,e),r()})):Promise.reject(e)})}Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},a=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),u=r(1);Object.defineProperty(e,"ensureThat",{enumerable:!0,get:function(){return u.ensureThat}});var s=function(){function t(e){n(this,t),this.aborted=!1,this.operations=[],this.handlers={},this.currentOperation=void 0,this.isSynchronous=!0,this.aspects={invocation:{before:[],after:[]}},this.scope=e,e.routine=this}return a(t,[{key:"addOperation",value:function(e){return t.validateOperation(e),this.operations.push(e),this}},{key:"first",value:function(t){return this.addOperation(t),this}},{key:"then",value:function(t){return this.addOperation(t),this}},{key:"on",value:function(e,r){var n=this;return t.validateOperation(r),this.handlers[e]=function(t){return r.call(n.scope,t)},this}},{key:"abort",value:function(){this.aborted=!0}},{key:"invoke",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=e.operation,n=e.args,o=e.hasMultipleArgs,i=void 0!==o&&o,a=e.respectAbort,u=void 0===a||a,s=e.recordIt,c=void 0===s||s,f=e.runAspects,l=void 0===f||f;if(l){var h=!0,p=!1,v=void 0;try{for(var d,y=this.aspects.invocation.before[Symbol.iterator]();!(h=(d=y.next()).done);h=!0){var b=d.value;b({operation:r,args:n,hasMultipleArgs:i,respectAbort:u,recordIt:c})}}catch(m){p=!0,v=m}finally{try{!h&&y["return"]&&y["return"]()}finally{if(p)throw v}}}if(!u||!this.aborted){c&&(this.currentOperation=r);var k=void 0;if(k=t.isRunnable(r)?r.run(this):i?r.apply(this.scope,n):r.call(this.scope,n),l){var g=!0,w=!1,O=void 0;try{for(var x,j=this.aspects.invocation.after[Symbol.iterator]();!(g=(x=j.next()).done);g=!0){var A=x.value;A({operation:r,args:n,hasMultipleArgs:i,respectAbort:u,recordIt:c,result:k})}}catch(m){w=!0,O=m}finally{try{!g&&j["return"]&&j["return"]()}finally{if(w)throw O}}}return k}}},{key:"run",value:function(){var e=void 0;try{for(var r=0;r<this.operations.length;r++){var n=this.operations[r];if(e=this.invoke({operation:n,args:e}),e instanceof Promise){this.isSynchronous=!1;var i=this.operations.slice(r+1,this.operations.length);return o(this,i,e)}}return e}catch(a){t.handleError(this,a)}}},{key:"setup",get:function(){return{as:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var o=!0,i=!1,a=void 0;try{for(var u,s=r[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var c=u.value;t.validateOperation(c),this.invoke({operation:c,args:this,respectAbort:!1,runAspects:!1})}}catch(f){i=!0,a=f}finally{try{!o&&s["return"]&&s["return"]()}finally{if(i)throw a}}}}}},{key:"and",get:function(){return this}},{key:"but",get:function(){return this}}],[{key:"set",value:function(e){return new t(e)}},{key:"isRunnable",value:function(t){return"object"===("undefined"==typeof t?"undefined":i(t))&&void 0!==t.run}},{key:"validateOperation",value:function(e){if(!t.isRunnable(e)&&"function"!=typeof e)throw new Error("Invalid operation type - An operation has to either be a function or an object with a `run()` method. Instead an operation of type "+("'"+("undefined"==typeof e?"undefined":i(e))+"' was supplied."))}},{key:"handleError",value:function(t,e){if(e.$state=t.scope.state,e.$invocation={operation:t.currentOperation.name},t.handlers.error)t.invoke({operation:t.handlers.error,args:e,recordIt:!1,respectAbort:!1});else if(t.isSynchronous)throw e}}]),t}();e["default"]=s},function(t,e){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t){return new s(t)}function o(t,e,r){var n=t.routine,o=r,a=[o].concat(e),u=!0,s=!1,c=void 0;try{for(var f,l=a[Symbol.iterator]();!(u=(f=l.next()).done);u=!0){var h=f.value;o=o.then(h).then(function(t){if(!t)return Promise.reject(i(n))})}}catch(p){s=!0,c=p}finally{try{!u&&l["return"]&&l["return"]()}finally{if(s)throw c}}return o}function i(t){return new Error("Required condition of routine was not met -  "+t.currentOperation.name+" returned false")}function a(t,e){return function(r){return e.routine.invoke({operation:t,args:r})}}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();e.ensureThat=n;var s=function(){function t(e){r(this,t),this.scope={},this.operations=[],this.elseOperation=void 0,this.addOperation(e)}return u(t,[{key:"addOperation",value:function(t){this.operations.push(a(t,this))}},{key:"that",value:function(t){return this.addOperation(t),this}},{key:"otherwise",value:function(t){return this.elseOperation=a(t,this),this}},{key:"run",value:function(t){this.routine=t;for(var e=0;e<this.operations.length;e++){var r=this.operations[e],n=r();if(n instanceof Promise){var a=this.operations.slice(e+1,this.operations.length);return o(this,a,n)}if(!n){if(this.elseOperation){var u=this.elseOperation();return this.routine.abort(),u}throw i(t)}}}},{key:"and",get:function(){return this}}]),t}();e["default"]=s}])});
//# sourceMappingURL=Routine.min.js.map