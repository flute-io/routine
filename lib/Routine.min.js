!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("routine",[],r):"object"==typeof exports?exports.routine=r():e.routine=r()}(this,function(){return function(e){function r(n){if(t[n])return t[n].exports;var o=t[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var t={};return r.m=e,r.c=t,r.p="",r(0)}([function(e,r){"use strict";function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function n(e,r,t){var n=Promise.resolve(t),o=!0,i=!1,s=void 0;try{for(var u,l=function(){var r=u.value;n=n.then(function(t){return e.invoke({operation:r,args:t})})},f=r[Symbol.iterator]();!(o=(u=f.next()).done);o=!0)l()}catch(c){i=!0,s=c}finally{try{!o&&f["return"]&&f["return"]()}finally{if(i)throw s}}return n=n["catch"](function(r){return e.handlers.error?(e.abort(),new Promise(function(t){a.handleError(e,r),t()})):Promise.reject(r)})}Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},i=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),a=function(){function e(r){t(this,e),this.aborted=!1,this.operations=[],this.handlers={},this.currentOperation=void 0,this.isSynchronous=!0,this.scope=r||{},this.scope.routine=this}return i(e,[{key:"addOperation",value:function(r){return e.validateOperation(r),this.operations.push(r),this}},{key:"first",value:function(e){return this.addOperation(e),this}},{key:"then",value:function(e){return this.addOperation(e),this}},{key:"on",value:function(r,t){var n=this;return e.validateOperation(t),this.handlers[r]||(this.handlers[r]=[]),this.handlers[r].push(function(e){return t.call(n.scope,e)}),this}},{key:"use",value:function(e){e(this)}},{key:"abort",value:function(){this.aborted=!0}},{key:"invoke",value:function(){var r=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=r.operation,n=r.args,o=r.hasMultipleArgs,i=void 0!==o&&o,a=r.respectAbort,s=void 0===a||a,u=r.recordIt,l=void 0===u||u,f=r.runHandlers,c=void 0===f||f,h={operation:t,args:n,hasMultipleArgs:i,respectAbort:s,recordIt:l,runHandlers:c};if(h.runHandlers&&this.handlers["before-invoking-operation"]){var p=!0,d=!1,v=void 0;try{for(var y,b=this.handlers["before-invoking-operation"][Symbol.iterator]();!(p=(y=b.next()).done);p=!0){var k=y.value;k(h)}}catch(g){d=!0,v=g}finally{try{!p&&b["return"]&&b["return"]()}finally{if(d)throw v}}}if(!h.respectAbort||!this.aborted){h.recordIt&&(this.currentOperation=h.operation);var m=void 0;if(m=e.isRunnable(h.operation)?h.operation.run(this):h.hasMultipleArgs?h.operation.apply(this.scope,h.args):h.operation.call(this.scope,h.args),c&&this.handlers["after-invoking-operation"]){var w=!0,x=!1,O=void 0;try{for(var A,S=this.handlers["after-invoking-operation"][Symbol.iterator]();!(w=(A=S.next()).done);w=!0){var j=A.value;j({operation:t,args:n,hasMultipleArgs:i,respectAbort:s,recordIt:l,result:m})}}catch(g){x=!0,O=g}finally{try{!w&&S["return"]&&S["return"]()}finally{if(x)throw O}}}return m}}},{key:"run",value:function(){var r=void 0;try{for(var t=0;t<this.operations.length;t++){var o=this.operations[t];if(r=this.invoke({operation:o,args:r}),r instanceof Promise){this.isSynchronous=!1;var i=this.operations.slice(t+1,this.operations.length);return n(this,i,r)}}return r}catch(a){e.handleError(this,a)}}},{key:"set",value:function(e){for(var r in e)e.hasOwnProperty(r)&&(this.scope[r]=e);return this}},{key:"setup",get:function(){return{as:function(){for(var r=arguments.length,t=Array(r),n=0;n<r;n++)t[n]=arguments[n];var o=!0,i=!1,a=void 0;try{for(var s,u=t[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var l=s.value;e.validateOperation(l),this.invoke({operation:l,args:this,respectAbort:!1,runAspects:!1})}}catch(f){i=!0,a=f}finally{try{!o&&u["return"]&&u["return"]()}finally{if(i)throw a}}}}}},{key:"and",get:function(){return this}},{key:"but",get:function(){return this}}],[{key:"use",value:function(r){var t=new e;return t.use(r),t}},{key:"set",value:function(r){return new e(r)}},{key:"isRunnable",value:function(e){return"object"===("undefined"==typeof e?"undefined":o(e))&&void 0!==e.run}},{key:"validateOperation",value:function(r){if(!e.isRunnable(r)&&"function"!=typeof r)throw new Error("Invalid operation type - An operation has to either be a function or an object with a `run()` method. Instead an operation of type "+("'"+("undefined"==typeof r?"undefined":o(r))+"' was supplied."))}},{key:"handleError",value:function(e,r){if(r.$state=e.scope.state,r.$invocation={operation:e.currentOperation?e.currentOperation.name:"unknown operation"},e.handlers.error){var t=!0,n=!1,o=void 0;try{for(var i,a=e.handlers.error[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;e.invoke({operation:s,args:r,recordIt:!1,respectAbort:!1})}}catch(u){n=!0,o=u}finally{try{!t&&a["return"]&&a["return"]()}finally{if(n)throw o}}}else if(e.isSynchronous)throw r}}]),e}();r["default"]=a,e.exports=r["default"]}])});
//# sourceMappingURL=Routine.min.js.map