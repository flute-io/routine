!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("routine",[],e):"object"==typeof exports?exports.routine=e():t.routine=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e,r){var n=Promise.resolve(r),o=!0,i=!1,s=void 0;try{for(var u,c=function(){var e=u.value;n=n.then(function(r){return t.invoke({operation:e,args:r})})},f=e[Symbol.iterator]();!(o=(u=f.next()).done);o=!0)c()}catch(l){i=!0,s=l}finally{try{!o&&f["return"]&&f["return"]()}finally{if(i)throw s}}return n=n["catch"](function(e){return t.handlers.error?(t.abort(),new Promise(function(r){a.handleError(t,e),r()})):Promise.reject(e)})}Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=function(){function t(e){r(this,t),this.aborted=!1,this.operations=[],this.handlers={},this.currentOperation=void 0,this.isSynchronous=!0,this.aspects={invocation:{before:[],after:[]}},this.scope=e,e.routine=this}return i(t,[{key:"addOperation",value:function(e){return t.validateOperation(e),this.operations.push(e),this}},{key:"first",value:function(t){return this.addOperation(t),this}},{key:"then",value:function(t){return this.addOperation(t),this}},{key:"on",value:function(e,r){var n=this;return t.validateOperation(r),this.handlers[e]=function(t){return r.call(n.scope,t)},this}},{key:"abort",value:function(){this.aborted=!0}},{key:"invoke",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=e.operation,n=e.args,o=e.hasMultipleArgs,i=void 0!==o&&o,a=e.respectAbort,s=void 0===a||a,u=e.recordIt,c=void 0===u||u,f=e.runAspects,l=void 0===f||f;if(l){var p=!0,h=!1,d=void 0;try{for(var v,y=this.aspects.invocation.before[Symbol.iterator]();!(p=(v=y.next()).done);p=!0){var b=v.value;b({operation:r,args:n,hasMultipleArgs:i,respectAbort:s,recordIt:c})}}catch(m){h=!0,d=m}finally{try{!p&&y["return"]&&y["return"]()}finally{if(h)throw d}}}if(!s||!this.aborted){c&&(this.currentOperation=r);var k=void 0;if(k=t.isRunnable(r)?r.run(this):i?r.apply(this.scope,n):r.call(this.scope,n),l){var g=!0,w=!1,x=void 0;try{for(var A,O=this.aspects.invocation.after[Symbol.iterator]();!(g=(A=O.next()).done);g=!0){var S=A.value;S({operation:r,args:n,hasMultipleArgs:i,respectAbort:s,recordIt:c,result:k})}}catch(m){w=!0,x=m}finally{try{!g&&O["return"]&&O["return"]()}finally{if(w)throw x}}}return k}}},{key:"run",value:function(){var e=void 0;try{for(var r=0;r<this.operations.length;r++){var o=this.operations[r];if(e=this.invoke({operation:o,args:e}),e instanceof Promise){this.isSynchronous=!1;var i=this.operations.slice(r+1,this.operations.length);return n(this,i,e)}}return e}catch(a){t.handleError(this,a)}}},{key:"setup",get:function(){return{as:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var o=!0,i=!1,a=void 0;try{for(var s,u=r[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var c=s.value;t.validateOperation(c),this.invoke({operation:c,args:this,respectAbort:!1,runAspects:!1})}}catch(f){i=!0,a=f}finally{try{!o&&u["return"]&&u["return"]()}finally{if(i)throw a}}}}}},{key:"and",get:function(){return this}},{key:"but",get:function(){return this}}],[{key:"set",value:function(e){return new t(e)}},{key:"isRunnable",value:function(t){return"object"===("undefined"==typeof t?"undefined":o(t))&&void 0!==t.run}},{key:"validateOperation",value:function(e){if(!t.isRunnable(e)&&"function"!=typeof e)throw new Error("Invalid operation type - An operation has to either be a function or an object with a `run()` method. Instead an operation of type "+("'"+("undefined"==typeof e?"undefined":o(e))+"' was supplied."))}},{key:"handleError",value:function(t,e){if(e.$state=t.scope.state,e.$invocation={operation:t.currentOperation.name},t.handlers.error)t.invoke({operation:t.handlers.error,args:e,recordIt:!1,respectAbort:!1});else if(t.isSynchronous)throw e}}]),t}();e["default"]=a,t.exports=e["default"]}])});
//# sourceMappingURL=Routine.min.js.map