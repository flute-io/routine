!function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("routine",[],e):"object"==typeof exports?exports.routine=e():r.routine=e()}(this,function(){return function(r){function e(n){if(t[n])return t[n].exports;var o=t[n]={exports:{},id:n,loaded:!1};return r[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var t={};return e.m=r,e.c=t,e.p="",e(0)}([function(r,e){"use strict";function t(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function n(r,e,t){var n=Promise.resolve(t),o=!0,i=!1,s=void 0;try{for(var u,l=function(){var e=u.value;n=n.then(function(t){return r.invoke({operation:e,args:t})})},f=e[Symbol.iterator]();!(o=(u=f.next()).done);o=!0)l()}catch(c){i=!0,s=c}finally{try{!o&&f["return"]&&f["return"]()}finally{if(i)throw s}}return n=n["catch"](function(e){return r.handlers.error?(r.abort(),new Promise(function(t){a.handleError(r,e),t()})):Promise.reject(e)})}Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol?"symbol":typeof r},i=function(){function r(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),a=function(){function r(e){t(this,r),this.aborted=!1,this.operations=[],this.handlers={},this.currentOperation=void 0,this.isSynchronous=!0,this.scope=e||{},this.scope.routine=this}return i(r,[{key:"addOperation",value:function(e){return r.validateOperation(e),this.operations.push(e),this}},{key:"first",value:function(r){return this.addOperation(r),this}},{key:"then",value:function(r){return this.addOperation(r),this}},{key:"on",value:function(e,t){var n=this;return r.validateOperation(t),this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(function(r){return t.call(n.scope,r)}),this}},{key:"use",value:function(r){return r(this),this}},{key:"abort",value:function(){this.aborted=!0}},{key:"invoke",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.operation,n=e.args,o=e.hasMultipleArgs,i=void 0!==o&&o,a=e.respectAbort,s=void 0===a||a,u=e.recordIt,l=void 0===u||u,f=e.runHandlers,c=void 0===f||f,h={operation:t,args:n,hasMultipleArgs:i,respectAbort:s,recordIt:l,runHandlers:c};if(h.runHandlers&&this.handlers["before-invoking-operation"]){var p=!0,d=!1,v=void 0;try{for(var y,b=this.handlers["before-invoking-operation"][Symbol.iterator]();!(p=(y=b.next()).done);p=!0){var k=y.value;k(h)}}catch(g){d=!0,v=g}finally{try{!p&&b["return"]&&b["return"]()}finally{if(d)throw v}}}if(!h.respectAbort||!this.aborted){h.recordIt&&(this.currentOperation=h.operation);var m=void 0;if(m=r.isRunnable(h.operation)?h.operation.run(this):h.hasMultipleArgs?h.operation.apply(this.scope,h.args):h.operation.call(this.scope,h.args),c&&this.handlers["after-invoking-operation"]){var w=!0,x=!1,O=void 0;try{for(var A,S=this.handlers["after-invoking-operation"][Symbol.iterator]();!(w=(A=S.next()).done);w=!0){var j=A.value;j({operation:t,args:n,hasMultipleArgs:i,respectAbort:s,recordIt:l,result:m})}}catch(g){x=!0,O=g}finally{try{!w&&S["return"]&&S["return"]()}finally{if(x)throw O}}}return m}}},{key:"run",value:function(){var e=void 0;try{for(var t=0;t<this.operations.length;t++){var o=this.operations[t];if(e=this.invoke({operation:o,args:e}),e instanceof Promise){this.isSynchronous=!1;var i=this.operations.slice(t+1,this.operations.length);return n(this,i,e)}}return e}catch(a){r.handleError(this,a)}}},{key:"set",value:function(r){for(var e in r)r.hasOwnProperty(e)&&(this.scope[e]=r[e]);return this}},{key:"setup",get:function(){return{as:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=!0,i=!1,a=void 0;try{for(var s,u=t[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var l=s.value;r.validateOperation(l),this.invoke({operation:l,args:this,respectAbort:!1,runAspects:!1})}}catch(f){i=!0,a=f}finally{try{!o&&u["return"]&&u["return"]()}finally{if(i)throw a}}}}}},{key:"and",get:function(){return this}},{key:"but",get:function(){return this}}],[{key:"use",value:function(e){var t=new r;return t.use(e),t}},{key:"set",value:function(e){return new r(e)}},{key:"isRunnable",value:function(r){return"object"===("undefined"==typeof r?"undefined":o(r))&&void 0!==r.run}},{key:"validateOperation",value:function(e){if(!r.isRunnable(e)&&"function"!=typeof e)throw new Error("Invalid operation type - An operation has to either be a function or an object with a `run()` method. Instead an operation of type "+("'"+("undefined"==typeof e?"undefined":o(e))+"' was supplied."))}},{key:"handleError",value:function(r,e){if(e.$state=r.scope.state,e.$invocation={operation:r.currentOperation?r.currentOperation.name:"unknown operation"},r.handlers.error){var t=!0,n=!1,o=void 0;try{for(var i,a=r.handlers.error[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;r.invoke({operation:s,args:e,recordIt:!1,respectAbort:!1})}}catch(u){n=!0,o=u}finally{try{!t&&a["return"]&&a["return"]()}finally{if(n)throw o}}}else if(r.isSynchronous)throw e}}]),r}();e["default"]=a,r.exports=e["default"]}])});
//# sourceMappingURL=Routine.min.js.map